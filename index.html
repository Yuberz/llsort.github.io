<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Love Live Character Sorter</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            :root {
                --primary: #ff66aa;
                --secondary: #f0f0f8;
                --accent: #99ccff;
                --text: #333333;
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
                font-family: "Arial", sans-serif;
            }

            body {
                background-color: var(--secondary);
                color: var(--text);
                padding: 20px;
                max-width: 1200px;
                margin: 0 auto;
            }

            header {
                text-align: center;
                margin: 20px 0;
            }

            h1 {
                color: var(--primary);
                font-size: 2.2rem;
                margin-bottom: 10px;
            }

            .panel {
                background-color: white;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                padding: 20px;
                margin-bottom: 20px;
            }

            .panel h2 {
                margin-bottom: 15px;
                color: var(--primary);
                font-size: 1.4rem;
            }

            .group-container {
                display: flex;
                flex-wrap: wrap;
                gap: 15px;
                margin-top: 10px;
            }

            .group-item {
                display: flex;
                align-items: center;
                gap: 5px;
            }

            .matchup-container {
                display: flex;
                justify-content: center;
                gap: 50px;
                margin: 30px 0;
                flex-wrap: wrap;
            }

            .character-btn {
                background-color: white;
                border: 2px solid var(--accent);
                border-radius: 10px;
                padding: 15px;
                width: 300px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .character-btn:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
                border-color: var(--primary);
            }

            .character-img {
                width: 200px;
                height: 200px;
                object-fit: cover;
                border-radius: 10px;
                margin-bottom: 10px;
                background-color: #ffccdd;
            }

            .character-name {
                font-weight: bold;
                font-size: 1.2rem;
                margin-bottom: 5px;
            }

            .character-info {
                font-size: 0.9rem;
                color: #666;
            }

            .progress-container {
                text-align: center;
                margin: 20px 0;
                font-size: 1.1rem;
            }

            .btn-container {
                display: flex;
                justify-content: center;
                gap: 15px;
                margin: 20px 0;
            }

            button {
                background-color: var(--primary);
                color: white;
                border: none;
                border-radius: 5px;
                padding: 10px 20px;
                font-size: 1rem;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            button:hover {
                background-color: #ff4488;
            }

            .results-container {
                display: none;
            }

            .tab-container {
                margin-bottom: 20px;
            }

            .tab-buttons {
                display: flex;
                gap: 5px;
                margin-bottom: 15px;
            }

            .tab-btn {
                background-color: #ddd;
                color: #333;
            }

            .tab-btn.active {
                background-color: var(--primary);
                color: white;
            }

            .tab-content {
                display: none;
            }

            .tab-content.active {
                display: block;
            }

            .chart-container {
                height: 400px;
                margin: 20px 0;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
            }

            th,
            td {
                padding: 10px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }

            th {
                background-color: var(--accent);
            }

            .back-btn {
                background-color: #666;
            }

            .back-btn:hover {
                background-color: #555;
            }

            .setting-item {
                margin: 10px 0;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            @media (max-width: 768px) {
                .matchup-container {
                    flex-direction: column;
                    align-items: center;
                    gap: 20px;
                }

                .character-btn {
                    width: 100%;
                    max-width: 300px;
                }
            }
        </style>
    </head>
    <body>
        <div class="main-container">
            <header>
                <h1>Love Live Character Sorter</h1>
            </header>

            <div class="panel">
                <h2>Group Selection</h2>
                <div class="btn-container">
                    <button id="selectAllBtn">Select All</button>
                    <button id="selectNoneBtn">Select None</button>
                </div>
                <div id="groupContainer" class="group-container"></div>
            </div>

            <div class="panel">
                <h2>Settings</h2>
                <div class="setting-item">
                    <input type="checkbox" id="quickMode" />
                    <label for="quickMode"
                        >Quick Mode (use transitive relationships to reduce
                        comparisons)</label
                    >
                </div>
            </div>

            <div class="progress-container">
                <div id="progressText">
                    Select at least 2 characters from groups
                </div>
            </div>

            <div class="matchup-container" id="matchupContainer">
                <!-- Character buttons will be added here dynamically -->
            </div>

            <div class="btn-container">
                <button id="resultsBtn" disabled>View Results</button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer">
            <div class="btn-container">
                <button class="back-btn" id="backBtn">
                    Back to Tournament
                </button>
            </div>

            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="rankings">
                        Rankings
                    </button>
                    <button class="tab-btn" data-tab="year">Year Stats</button>
                    <button class="tab-btn" data-tab="group">
                        Group Stats
                    </button>
                    <button class="tab-btn" data-tab="blood">Blood Type</button>
                    <button class="tab-btn" data-tab="height">
                        Height Analysis
                    </button>
                </div>

                <div id="rankingsTab" class="tab-content active">
                    <h2>Character Rankings</h2>
                    <table id="rankingsTable">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Character</th>
                                <th>Wins</th>
                                <th>Year</th>
                                <th>Group</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="yearTab" class="tab-content">
                    <h2>Year Statistics</h2>
                    <div class="chart-container">
                        <canvas id="yearChart"></canvas>
                    </div>
                </div>

                <div id="groupTab" class="tab-content">
                    <h2>Group Statistics</h2>
                    <div class="chart-container">
                        <canvas id="groupChart"></canvas>
                    </div>
                </div>

                <div id="bloodTab" class="tab-content">
                    <h2>Blood Type Statistics</h2>
                    <div class="chart-container">
                        <canvas id="bloodChart"></canvas>
                    </div>
                </div>

                <div id="heightTab" class="tab-content">
                    <h2>Height Analysis</h2>
                    <div id="heightStats"></div>
                    <div class="chart-container">
                        <canvas id="heightChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Character data with blood type and height
            const CHARACTER_DATA = [
                // Î¼'s characters
                {
                    name: "Honoka Kosaka",
                    year: 2,
                    group: "Î¼'s",
                    blood_type: "O",
                    height: 157,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/e/e9/Main_Page_Honoka.png",
                },
                {
                    name: "Kotori Minami",
                    year: 2,
                    group: "Î¼'s",
                    blood_type: "O",
                    height: 159,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/0/02/Main_Page_Kotori.png",
                },
                {
                    name: "Umi Sonoda",
                    year: 2,
                    group: "Î¼'s",
                    blood_type: "A",
                    height: 159,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/5/5d/Main_Page_Umi.png",
                },
                {
                    name: "Hanayo Koizumi",
                    year: 1,
                    group: "Î¼'s",
                    blood_type: "A",
                    height: 156,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/2/27/Main_Page_Hanayo.png",
                },
                {
                    name: "Rin Hoshizora",
                    year: 1,
                    group: "Î¼'s",
                    blood_type: "AB",
                    height: 155,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/6/69/Main_Page_Rin.png",
                },
                {
                    name: "Maki Nishikino",
                    year: 1,
                    group: "Î¼'s",
                    blood_type: "A",
                    height: 161,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/3/3e/Main_Page_Maki.png",
                },
                {
                    name: "Nico Yazawa",
                    year: 3,
                    group: "Î¼'s",
                    blood_type: "A",
                    height: 154,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/5/5f/Main_Page_Nico.png",
                },
                {
                    name: "Eli Ayase",
                    year: 3,
                    group: "Î¼'s",
                    blood_type: "B",
                    height: 162,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/1/1b/Main_Page_Eli.png",
                },
                {
                    name: "Nozomi Tojo",
                    year: 3,
                    group: "Î¼'s",
                    blood_type: "O",
                    height: 159,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/a/ab/Main_Page_Nozomi.png",
                },

                // Aqours characters
                {
                    name: "Chika Takami",
                    year: 2,
                    group: "Aqours",
                    blood_type: "B",
                    height: 157,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/b/bc/Main_Page_Chika.png",
                },
                {
                    name: "Riko Sakurauchi",
                    year: 2,
                    group: "Aqours",
                    blood_type: "A",
                    height: 160,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/c/c4/Main_Page_Riko.png",
                },
                {
                    name: "Kanan Matsuura",
                    year: 3,
                    group: "Aqours",
                    blood_type: "O",
                    height: 162,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/8/8a/Main_Page_Kanan.png",
                },
                {
                    name: "Dia Kurosawa",
                    year: 3,
                    group: "Aqours",
                    blood_type: "A",
                    height: 162,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/c/cb/Main_Page_Dia.png",
                },
                {
                    name: "You Watanabe",
                    year: 2,
                    group: "Aqours",
                    blood_type: "AB",
                    height: 157,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/8/84/Main_Page_You.png",
                },
                {
                    name: "Yoshiko Tsushima",
                    year: 1,
                    group: "Aqours",
                    blood_type: "O",
                    height: 156,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/c/c7/Main_Page_Yoshiko.png",
                },
                {
                    name: "Hanamaru Kunikida",
                    year: 1,
                    group: "Aqours",
                    blood_type: "O",
                    height: 152,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/8/85/Main_Page_Hanamaru.png",
                },
                {
                    name: "Mari Ohara",
                    year: 3,
                    group: "Aqours",
                    blood_type: "AB",
                    height: 163,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/a/a0/Main_Page_Mari.png",
                },
                {
                    name: "Ruby Kurosawa",
                    year: 1,
                    group: "Aqours",
                    blood_type: "A",
                    height: 157,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/4/46/Main_Page_Ruby.png",
                },

                // Nijigaku characters
                {
                    name: "Yu Takasaki",
                    year: 2,
                    group: "Nijigaku",
                    blood_type: "-",
                    height: 156,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/5/5a/Main_Page_Yu.png",
                },
                {
                    name: "Ayumu Uehara",
                    year: 2,
                    group: "Nijigaku",
                    blood_type: "A",
                    height: 159,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/8/8a/Main_Page_Ayumu.png",
                },
                {
                    name: "Kasumi Nakasu",
                    year: 1,
                    group: "Nijigaku",
                    blood_type: "B",
                    height: 155,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/b/ba/Main_Page_Kasumi.png",
                },
                {
                    name: "Shizuku Osaka",
                    year: 1,
                    group: "Nijigaku",
                    blood_type: "A",
                    height: 157,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/b/b8/Main_Page_Shizuku.png",
                },
                {
                    name: "Karin Asaka",
                    year: 3,
                    group: "Nijigaku",
                    blood_type: "AB",
                    height: 167,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/7/71/Main_Page_Karin.png",
                },
                {
                    name: "Ai Miyashita",
                    year: 2,
                    group: "Nijigaku",
                    blood_type: "A",
                    height: 163,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/b/b4/Main_Page_Ai.png",
                },
                {
                    name: "Kanata Konoe",
                    year: 3,
                    group: "Nijigaku",
                    blood_type: "O",
                    height: 158,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/9/99/Main_Page_Kanata.png",
                },
                {
                    name: "Setsuna Yuki",
                    year: 2,
                    group: "Nijigaku",
                    blood_type: "O",
                    height: 154,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/7/76/Main_Page_Setsuna.png",
                },
                {
                    name: "Emma Verde",
                    year: 3,
                    group: "Nijigaku",
                    blood_type: "O",
                    height: 166,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/8/82/Main_Page_Emma.png",
                },
                {
                    name: "Rina Tennoji",
                    year: 1,
                    group: "Nijigaku",
                    blood_type: "B",
                    height: 149,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/c/cf/Main_Page_Rina.png",
                },
                {
                    name: "Shioriko Mifune",
                    year: 1,
                    group: "Nijigaku",
                    blood_type: "AB",
                    height: 160,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/0/07/Main_Page_Shioriko.png",
                },
                {
                    name: "Mia Taylor",
                    year: 3,
                    group: "Nijigaku",
                    blood_type: "AB",
                    height: 156,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/1/13/Main_Page_Mia.png",
                },
                {
                    name: "Lanzhu Zhong",
                    year: 2,
                    group: "Nijigaku",
                    blood_type: "B",
                    height: 165,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/d/d3/Main_Page_Lanzhu.png",
                },

                // Liella! characters
                {
                    name: "Kanon Shibuya",
                    year: 3,
                    group: "Liella!",
                    blood_type: "A",
                    height: 159,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/d/d2/Main_Page_Kanon.png",
                },
                {
                    name: "Keke Tang",
                    year: 3,
                    group: "Liella!",
                    blood_type: "O",
                    height: 159,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/5/50/Main_Page_Keke.png",
                },
                {
                    name: "Chisato Arashi",
                    year: 3,
                    group: "Liella!",
                    blood_type: "B",
                    height: 155,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/f/f5/Main_Page_Chisato.png",
                },
                {
                    name: "Sumire Heanna",
                    year: 3,
                    group: "Liella!",
                    blood_type: "AB",
                    height: 161,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/6/65/Main_Page_Sumire.png",
                },
                {
                    name: "Ren Hazuki",
                    year: 3,
                    group: "Liella!",
                    blood_type: "A",
                    height: 163,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/b/b3/Main_Page_Ren.png",
                },
                {
                    name: "Kinako Sakurakoji",
                    year: 2,
                    group: "Liella!",
                    blood_type: "O",
                    height: 159,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/2/28/Main_Page_Kinako.png",
                },
                {
                    name: "Mei Yoneme",
                    year: 2,
                    group: "Liella!",
                    blood_type: "A",
                    height: 155,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/6/6c/Main_Page_Mei.png",
                },
                {
                    name: "Shiki Wakana",
                    year: 2,
                    group: "Liella!",
                    blood_type: "B",
                    height: 161,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/2/2f/Main_Page_Shiki.png",
                },
                {
                    name: "Natsumi Onitsuka",
                    year: 2,
                    group: "Liella!",
                    blood_type: "AB",
                    height: 152,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/9/9a/Main_Page_Natsumi.png",
                },
                {
                    name: "Wien Margarete",
                    year: 1,
                    group: "Liella!",
                    blood_type: "A",
                    height: 161,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/8/81/Main_Page_Wien.png",
                },
                {
                    name: "Tomari Onitsuka",
                    year: 1,
                    group: "Liella!",
                    blood_type: "B",
                    height: 163,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/c/c0/Main_Page_Tomari.png",
                },

                // Hasunosora characters
                {
                    name: "Kaho Hinoshita",
                    year: 3,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 155,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/2/23/Main_Page_Kaho.png",
                },
                {
                    name: "Sayaka Murano",
                    year: 3,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 157,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/6/69/Main_Page_Sayaka.png",
                },
                {
                    name: "Kozue Otomune",
                    year: 4,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 167,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/4/44/Main_Page_Kozue.png",
                },
                {
                    name: "Tsuzuri Yugiri",
                    year: 4,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 171,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/6/63/Main_Page_Tsuzuri.png",
                },
                {
                    name: "Rurino Osawa",
                    year: 3,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 151,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/2/22/Main_Page_Rurino.png",
                },
                {
                    name: "Megumi Fujishima",
                    year: 4,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 160,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/5/54/Main_Page_Megumi.png",
                },
                {
                    name: "Ginko Momose",
                    year: 2,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 162,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/8/80/Main_Page_Ginko.png",
                },
                {
                    name: "Kosuzu Kachimachi",
                    year: 2,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 152,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/8/8e/Main_Page_Kosuzu.png",
                },
                {
                    name: "Hime Anyoji",
                    year: 2,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 160,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/c/c6/Main_Page_Hime.png",
                },
                {
                    name: "Ceras Yanagida Lilienfeld",
                    year: 1,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 153,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/5/5a/Main_Page_Ceras.png",
                },
                {
                    name: "Izumi Katsuragi",
                    year: 2,
                    group: "Hasunosora",
                    blood_type: "-",
                    height: 170,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/0/07/Main_Page_Izumi.png",
                },

                // Ikizurai-Bu! characters
                {
                    name: "Polka Takahashi",
                    year: 1,
                    group: "Ikizurai-Bu!",
                    blood_type: "-",
                    height: 157,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/2/2e/Main_Page_Polka.png",
                },
                {
                    name: "Mai Azabu",
                    year: 1,
                    group: "Ikizurai-Bu!",
                    blood_type: "B",
                    height: 154,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/c/cf/Main_Page_Mai.png",
                },
                {
                    name: "Akira Goto",
                    year: 1,
                    group: "Ikizurai-Bu!",
                    blood_type: "O",
                    height: 164,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/1/19/Main_Page_Akira.png",
                },
                {
                    name: "Hanabi Komagata",
                    year: 1,
                    group: "Ikizurai-Bu!",
                    blood_type: "A",
                    height: 160,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/b/ba/Main_Page_Hanabi.png",
                },
                {
                    name: "Miracle Kanazawa",
                    year: 2,
                    group: "Ikizurai-Bu!",
                    blood_type: "AB",
                    height: 152,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/b/bf/Main_Page_Miracle.png",
                },
                {
                    name: "Noriko Chofu",
                    year: 1,
                    group: "Ikizurai-Bu!",
                    blood_type: "B",
                    height: 153,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/0/0a/Main_Page_Noriko.png",
                },
                {
                    name: "Yukuri Harumiya",
                    year: 1,
                    group: "Ikizurai-Bu!",
                    blood_type: "B",
                    height: 165,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/e/ef/Main_Page_Yukuri.png",
                },
                {
                    name: "Aurora Konohana",
                    year: 2,
                    group: "Ikizurai-Bu!",
                    blood_type: "O",
                    height: 162,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/2/29/Main_Page_Aurora.png",
                },
                {
                    name: "Midori Yamada",
                    year: 1,
                    group: "Ikizurai-Bu!",
                    blood_type: "A",
                    height: 155,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/d/d7/Main_Page_Midori.png",
                },
                {
                    name: "Shion Sasaki",
                    year: 1,
                    group: "Ikizurai-Bu!",
                    blood_type: "-",
                    height: 158,
                    image_url:
                        "https://static.wikia.nocookie.net/love-live/images/e/e0/Main_Page_Shion.png",
                },
            ];

            // Tournament state
            let tournament = {
                characters: [],
                wins: {},
                matchups: [],
                currentMatchup: 0,
                comparisonsDone: 0,
                skippedComparisons: 0,
                totalPossibleMatchups: 0,
                graph: {},
                quickMode: false,
                selectedGroups: [],
            };

            // DOM Elements
            const groupContainer = document.getElementById("groupContainer");
            const matchupContainer =
                document.getElementById("matchupContainer");
            const progressText = document.getElementById("progressText");
            const resultsBtn = document.getElementById("resultsBtn");
            const mainContainer = document.querySelector(".main-container");
            const resultsContainer =
                document.getElementById("resultsContainer");
            const backBtn = document.getElementById("backBtn");
            const selectAllBtn = document.getElementById("selectAllBtn");
            const selectNoneBtn = document.getElementById("selectNoneBtn");
            const quickModeCheckbox = document.getElementById("quickMode");
            const tabButtons = document.querySelectorAll(".tab-btn");
            const tabContents = document.querySelectorAll(".tab-content");

            // Initialize the application
            function initApp() {
                // Extract unique groups
                const groups = [
                    ...new Set(CHARACTER_DATA.map((char) => char.group)),
                ];

                // Create group checkboxes
                groups.forEach((group) => {
                    const groupItem = document.createElement("div");
                    groupItem.className = "group-item";
                    groupItem.innerHTML = `
                        <input type="checkbox" id="${group}" class="group-checkbox" checked>
                        <label for="${group}">${group}</label>
                    `;
                    groupContainer.appendChild(groupItem);
                });

                // Set initial groups
                tournament.selectedGroups = groups;
                updateCharacterSelection();

                // Event listeners
                document
                    .querySelectorAll(".group-checkbox")
                    .forEach((checkbox) => {
                        checkbox.addEventListener(
                            "change",
                            updateCharacterSelection,
                        );
                    });

                selectAllBtn.addEventListener("click", () => {
                    document
                        .querySelectorAll(".group-checkbox")
                        .forEach((checkbox) => {
                            checkbox.checked = true;
                        });
                    updateCharacterSelection();
                });

                selectNoneBtn.addEventListener("click", () => {
                    document
                        .querySelectorAll(".group-checkbox")
                        .forEach((checkbox) => {
                            checkbox.checked = false;
                        });
                    updateCharacterSelection();
                });

                resultsBtn.addEventListener("click", showResults);
                backBtn.addEventListener("click", () => {
                    resultsContainer.style.display = "none";
                    mainContainer.style.display = "block";
                });

                quickModeCheckbox.addEventListener("change", () => {
                    tournament.quickMode = quickModeCheckbox.checked;
                    resetTournament();
                });

                // Tab switching
                tabButtons.forEach((button) => {
                    button.addEventListener("click", () => {
                        const tabId = button.getAttribute("data-tab");

                        // Update button states
                        tabButtons.forEach((btn) =>
                            btn.classList.remove("active"),
                        );
                        button.classList.add("active");

                        // Update tab content
                        tabContents.forEach((content) => {
                            content.classList.remove("active");
                            if (content.id === `${tabId}Tab`) {
                                content.classList.add("active");
                            }
                        });
                    });
                });
            }

            // Update character selection based on groups
            function updateCharacterSelection() {
                const selectedGroups = [];
                document
                    .querySelectorAll(".group-checkbox:checked")
                    .forEach((checkbox) => {
                        selectedGroups.push(checkbox.id);
                    });

                tournament.selectedGroups = selectedGroups;
                tournament.characters = CHARACTER_DATA.filter((char) =>
                    selectedGroups.includes(char.group),
                );

                // Reset tournament with new selection
                resetTournament();
            }

            // Reset tournament state
            function resetTournament() {
                tournament.wins = {};
                tournament.matchups = [];
                tournament.currentMatchup = 0;
                tournament.comparisonsDone = 0;
                tournament.skippedComparisons = 0;
                tournament.graph = {};

                // Initialize wins and graph
                tournament.characters.forEach((char) => {
                    tournament.wins[char.name] = 0;
                    tournament.graph[char.name] = new Set();
                });

                // Create matchups
                const names = tournament.characters.map((char) => char.name);
                for (let i = 0; i < names.length; i++) {
                    for (let j = i + 1; j < names.length; j++) {
                        tournament.matchups.push([names[i], names[j]]);
                    }
                }

                // Shuffle matchups
                shuffleArray(tournament.matchups);
                tournament.totalPossibleMatchups = tournament.matchups.length;

                // Update UI
                updateProgressText();
                resultsBtn.disabled = true;

                // Show first matchup
                showMatchup();
            }

            // Shuffle array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Show current matchup
            function showMatchup() {
                matchupContainer.innerHTML = "";

                if (tournament.characters.length < 2) {
                    progressText.textContent =
                        "Select at least 2 characters from groups";
                    return;
                }

                // Skip known relationships in quick mode
                if (tournament.quickMode) {
                    while (
                        tournament.currentMatchup < tournament.matchups.length
                    ) {
                        const [char1, char2] =
                            tournament.matchups[tournament.currentMatchup];

                        if (isKnownRelationship(char1, char2)) {
                            tournament.skippedComparisons++;
                            tournament.currentMatchup++;
                            updateProgressText();
                        } else {
                            break;
                        }
                    }
                }

                // Check if tournament is complete
                if (tournament.currentMatchup >= tournament.matchups.length) {
                    if (tournament.matchups.length > 0) {
                        resultsBtn.disabled = false;

                        // Update progress text for completion
                        if (tournament.quickMode) {
                            const progressPercent =
                                ((tournament.comparisonsDone +
                                    tournament.skippedComparisons) /
                                    tournament.totalPossibleMatchups) *
                                100;
                            progressText.textContent = `Sorting Complete! Comparisons: ${tournament.comparisonsDone} made, ${tournament.skippedComparisons} skipped\nProgress: ${progressPercent.toFixed(1)}%`;
                        } else {
                            progressText.textContent =
                                "Sorting Complete! Click 'View Results' to see rankings.";
                        }
                    }
                    return;
                }

                // Get current matchup characters
                const [char1Name, char2Name] =
                    tournament.matchups[tournament.currentMatchup];
                const char1 = tournament.characters.find(
                    (c) => c.name === char1Name,
                );
                const char2 = tournament.characters.find(
                    (c) => c.name === char2Name,
                );

                // Create matchup buttons
                const char1Btn = createCharacterButton(char1, 0);
                const char2Btn = createCharacterButton(char2, 1);

                matchupContainer.appendChild(char1Btn);
                matchupContainer.appendChild(char2Btn);

                // Update progress
                updateProgressText();
            }

            // Create character button
            function createCharacterButton(char, index) {
                const button = document.createElement("div");
                button.className = "character-btn";
                button.innerHTML = `
                    <img src="${char.image_url}" alt="${char.name}" class="character-img">
                    <div class="character-name">${char.name}</div>
                    <div class="character-info">${char.group} â¢ Year ${char.year}</div>
                `;

                button.addEventListener("click", () => {
                    recordChoice(index);
                });

                return button;
            }

            // Record user choice
            function recordChoice(choiceIndex) {
                const [char1Name, char2Name] =
                    tournament.matchups[tournament.currentMatchup];
                const winner = choiceIndex === 0 ? char1Name : char2Name;
                const loser = choiceIndex === 0 ? char2Name : char1Name;

                // Update wins
                tournament.wins[winner]++;
                tournament.comparisonsDone++;

                // Update graph in quick mode
                if (tournament.quickMode) {
                    updateGraph(winner, loser);
                }

                // Move to next matchup
                tournament.currentMatchup++;
                updateProgressText();
                showMatchup();
            }

            // Check if relationship is known
            function isKnownRelationship(char1, char2) {
                // Check if both characters are in the graph
                if (
                    !(char1 in tournament.graph) ||
                    !(char2 in tournament.graph)
                ) {
                    return false;
                }

                return (
                    tournament.graph[char1].has(char2) ||
                    tournament.graph[char2].has(char1)
                );
            }

            // Update propagation graph (FIXED)
            function updateGraph(winner, loser) {
                // Add direct relationship
                tournament.graph[winner].add(loser);

                // Winner is better than everyone loser is better than
                tournament.graph[loser].forEach((char) => {
                    tournament.graph[winner].add(char);
                });

                // Find all characters that are better than winner
                Object.keys(tournament.graph).forEach((char) => {
                    if (tournament.graph[char].has(winner)) {
                        // Add loser to characters that are better than winner
                        tournament.graph[char].add(loser);

                        // Add everyone loser is better than to characters that are better than winner
                        tournament.graph[loser].forEach((subChar) => {
                            tournament.graph[char].add(subChar);
                        });
                    }
                });
            }

            // Update progress text
            function updateProgressText() {
                if (tournament.quickMode) {
                    if (tournament.totalPossibleMatchups > 0) {
                        const progressPercent =
                            ((tournament.comparisonsDone +
                                tournament.skippedComparisons) /
                                tournament.totalPossibleMatchups) *
                            100;
                        progressText.textContent = `Comparisons: ${tournament.comparisonsDone} made, ${tournament.skippedComparisons} skipped.\nProgress: ${progressPercent.toFixed(1)}%`;
                    } else {
                        progressText.textContent =
                            "Select at least 2 characters from groups";
                    }
                } else {
                    if (tournament.matchups.length > 0) {
                        progressText.textContent = `Matchup ${tournament.currentMatchup + 1} of ${tournament.matchups.length}`;
                    } else {
                        progressText.textContent =
                            "Select at least 2 characters from groups";
                    }
                }
            }

            // Show results
            function showResults() {
                mainContainer.style.display = "none";
                resultsContainer.style.display = "block";

                // Show rankings
                showRankings();

                // Show year statistics
                showYearStats();

                // Show group statistics
                showGroupStats();

                // Show blood type statistics
                showBloodStats();

                // Show height analysis
                showHeightAnalysis();
            }

            // Show character rankings
            function showRankings() {
                const tableBody = document.querySelector(
                    "#rankingsTable tbody",
                );
                tableBody.innerHTML = "";

                // Sort characters by wins
                const sortedCharacters = [...tournament.characters].sort(
                    (a, b) => tournament.wins[b.name] - tournament.wins[a.name],
                );

                // Populate table
                sortedCharacters.forEach((char, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${char.name}</td>
                        <td>${tournament.wins[char.name]}</td>
                        <td>${char.year}</td>
                        <td>${char.group}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Show year statistics
            function showYearStats() {
                const yearWins = {};

                // Calculate wins by year
                tournament.characters.forEach((char) => {
                    const year = char.year;
                    if (!yearWins[year]) {
                        yearWins[year] = 0;
                    }
                    yearWins[year] += tournament.wins[char.name];
                });

                // Prepare chart data
                const years = Object.keys(yearWins).sort();
                const wins = years.map((year) => yearWins[year]);

                // Create chart
                const ctx = document
                    .getElementById("yearChart")
                    .getContext("2d");
                new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: years.map((year) => `Year ${year}`),
                        datasets: [
                            {
                                label: "Wins by Year",
                                data: wins,
                                backgroundColor: "#ff99cc",
                                borderColor: "#ff66aa",
                                borderWidth: 1,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: "Wins",
                                },
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: "School Year",
                                },
                            },
                        },
                    },
                });
            }

            // Show group statistics
            function showGroupStats() {
                const groupWins = {};

                // Calculate wins by group
                tournament.characters.forEach((char) => {
                    const group = char.group;
                    if (!groupWins[group]) {
                        groupWins[group] = 0;
                    }
                    groupWins[group] += tournament.wins[char.name];
                });

                // Prepare chart data
                const groups = Object.keys(groupWins);
                const wins = groups.map((group) => groupWins[group]);
                const backgroundColors = groups.map((_, i) => {
                    const colors = [
                        "#ff99cc",
                        "#99ccff",
                        "#99ff99",
                        "#ffcc99",
                        "#cc99ff",
                    ];
                    return colors[i % colors.length];
                });

                // Create chart
                const ctx = document
                    .getElementById("groupChart")
                    .getContext("2d");
                new Chart(ctx, {
                    type: "pie",
                    data: {
                        labels: groups,
                        datasets: [
                            {
                                label: "Wins by Group",
                                data: wins,
                                backgroundColor: backgroundColors,
                                borderWidth: 1,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: "right",
                            },
                        },
                    },
                });
            }

            // Show blood type statistics
            function showBloodStats() {
                const bloodWins = {};

                // Calculate wins by blood type
                tournament.characters.forEach((char) => {
                    const bt = char.blood_type;
                    if (bt !== "-") {
                        if (!bloodWins[bt]) {
                            bloodWins[bt] = 0;
                        }
                        bloodWins[bt] += tournament.wins[char.name];
                    }
                });

                // Prepare chart data
                const bloodTypes = Object.keys(bloodWins);
                const wins = bloodTypes.map((bt) => bloodWins[bt]);
                const backgroundColors = bloodTypes.map((_, i) => {
                    const colors = ["#ff9999", "#66b3ff", "#99ff99", "#ffcc99"];
                    return colors[i % colors.length];
                });

                // Create chart
                const ctx = document
                    .getElementById("bloodChart")
                    .getContext("2d");
                new Chart(ctx, {
                    type: "doughnut",
                    data: {
                        labels: bloodTypes.map((bt) => `Type ${bt}`),
                        datasets: [
                            {
                                label: "Wins by Blood Type",
                                data: wins,
                                backgroundColor: backgroundColors,
                                borderWidth: 1,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: "right",
                            },
                        },
                    },
                });
            }

            // Show height analysis (FIXED)
            function showHeightAnalysis() {
                const heightStats = document.getElementById("heightStats");
                const validHeightChars = tournament.characters.filter(
                    (char) => char.height > 0,
                );

                if (validHeightChars.length === 0) {
                    heightStats.textContent =
                        "No valid height data available for selected characters";
                    return;
                }

                // Calculate height statistics
                const overallAvg =
                    validHeightChars.reduce(
                        (sum, char) => sum + char.height,
                        0,
                    ) / validHeightChars.length;

                let userTotal = 0;
                let userCount = 0;
                validHeightChars.forEach((char) => {
                    const wins = tournament.wins[char.name];
                    userTotal += char.height * wins;
                    userCount += wins;
                });

                const userAvg = userCount > 0 ? userTotal / userCount : 0;

                // Determine preference
                const diff = userAvg - overallAvg;
                let preference;
                if (Math.abs(diff) < 0.5) {
                    preference = "You have no significant height preference.";
                } else if (diff > 0) {
                    preference =
                        "Your preferences lean toward taller characters.";
                } else {
                    preference =
                        "Your preferences lean toward shorter characters.";
                }

                // Display statistics
                heightStats.innerHTML = `
                    <p>Overall Average Height: <strong>${overallAvg.toFixed(1)} cm</strong></p>
                    <p>Your Preferred Average Height: <strong>${userAvg.toFixed(1)} cm</strong></p>
                    <p><strong>${preference}</strong></p>
                `;

                // Prepare data for chart - sort characters by height
                const sortedByHeight = [...validHeightChars].sort(
                    (a, b) => a.height - b.height,
                );
                const heights = sortedByHeight.map((char) => char.height);
                const winCounts = sortedByHeight.map(
                    (char) => tournament.wins[char.name],
                );
                const names = sortedByHeight.map((char) => char.name);
                const colors = winCounts.map(
                    (_, i) => `hsl(${220 + i * 10}, 70%, 60%)`,
                );

                // Create chart
                const ctx = document
                    .getElementById("heightChart")
                    .getContext("2d");
                new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: names,
                        datasets: [
                            {
                                label: "Wins",
                                data: winCounts,
                                backgroundColor: colors,
                                borderColor: colors.map((c) =>
                                    c.replace("60%", "50%"),
                                ),
                                borderWidth: 1,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: "Number of Wins",
                                },
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: "Character (Sorted by Height)",
                                },
                                ticks: {
                                    callback: function (value, index) {
                                        // Display character name with height in parentheses
                                        return `${names[index]} (${heights[index]}cm)`;
                                    },
                                    maxRotation: 90,
                                    minRotation: 45,
                                },
                            },
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    title: function (tooltipItems) {
                                        const char =
                                            sortedByHeight[
                                                tooltipItems[0].dataIndex
                                            ];
                                        return char.name;
                                    },
                                    label: function (context) {
                                        const char =
                                            sortedByHeight[context.dataIndex];
                                        return [
                                            `Height: ${char.height} cm`,
                                            `Wins: ${context.parsed.y}`,
                                            `Group: ${char.group}`,
                                            `Year: ${char.year}`,
                                        ];
                                    },
                                },
                            },
                        },
                    },
                });
            }

            // Initialize the application when the page loads
            document.addEventListener("DOMContentLoaded", initApp);
        </script>
    </body>
</html>
